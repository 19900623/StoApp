/**
* 选择列表插件
* varstion 2.0.0
* by Houfeng
* Houfeng@DCloud.io
**/
//!function(e,t,i,a){var n=30,r=90,s=40,c=10,l=e.rad2deg=function(e){return e/(Math.PI/180)},o=(e.deg2rad=function(e){return e*(Math.PI/180)},navigator.platform.toLowerCase()),d=navigator.userAgent.toLowerCase(),u=(d.indexOf("iphone")>-1||d.indexOf("ipad")>-1||d.indexOf("ipod")>-1)&&(o.indexOf("iphone")>-1||o.indexOf("ipad")>-1||o.indexOf("ipod")>-1),p=e.Picker=function(e,t){var i=this;i.holder=e,i.options=t||{},i.init(),i.initInertiaParams(),i.calcElementItemPostion(!0),i.bindEvent()};p.prototype.findElementItems=function(){var e=this;return e.elementItems=[].slice.call(e.holder.querySelectorAll("li")),e.elementItems},p.prototype.init=function(){var e=this;e.list=e.holder.querySelector("ul"),e.findElementItems(),e.height=e.holder.offsetHeight,e.r=e.height/2-c,e.d=2*e.r,e.itemHeight=e.elementItems.length>0?e.elementItems[0].offsetHeight:s,e.itemAngle=parseInt(e.calcAngle(.8*e.itemHeight)),e.hightlightRange=e.itemAngle/2,e.visibleRange=r,e.beginAngle=0,e.beginExceed=e.beginAngle-n,e.list.angle=e.beginAngle,u&&(e.list.style.webkitTransformOrigin="center center "+e.r+"px")},p.prototype.calcElementItemPostion=function(e){var t=this;e&&(t.items=[]),t.elementItems.forEach(function(i){var a=t.elementItems.indexOf(i);if(t.endAngle=t.itemAngle*a,i.angle=t.endAngle,i.style.webkitTransformOrigin="center center -"+t.r+"px",i.style.webkitTransform="translateZ("+t.r+"px) rotateX("+-t.endAngle+"deg)",e){var n={};n.text=i.innerHTML||"",n.value=i.getAttribute("data-value")||n.text,t.items.push(n)}}),t.endExceed=t.endAngle+n,t.calcElementItemVisibility(t.beginAngle)},p.prototype.calcAngle=function(e){var t=this,i=b=parseFloat(t.r);e=Math.abs(e);var a=180*parseInt(e/t.d);e%=t.d;var n=(i*i+b*b-e*e)/(2*i*b),r=a+l(Math.acos(n));return r},p.prototype.calcElementItemVisibility=function(e){var t=this;t.elementItems.forEach(function(i){var a=Math.abs(i.angle-e);a<t.hightlightRange?i.classList.add("highlight"):a<t.visibleRange?(i.classList.add("visible"),i.classList.remove("highlight")):(i.classList.remove("highlight"),i.classList.remove("visible"))})},p.prototype.setAngle=function(e){var t=this;t.list.angle=e,t.list.style.webkitTransform="perspective(1000px) rotateY(0deg) rotateX("+e+"deg)",t.calcElementItemVisibility(e)},p.prototype.bindEvent=function(){var e=this,t=0,i=null;e.holder.addEventListener("touchstart",function(a){a.preventDefault(),e.list.style.webkitTransition="",i=(a.changedTouches?a.changedTouches[0]:a).pageY,t=e.list.angle,e.updateInertiaParams(a,!0)},!1),e.holder.addEventListener("touchend",function(t){t.preventDefault(),e.startInertiaScroll(t)},!1),e.holder.addEventListener("touchcancel",function(t){t.preventDefault(),e.startInertiaScroll(t)},!1),e.holder.addEventListener("touchmove",function(a){a.preventDefault();var n=(a.changedTouches?a.changedTouches[0]:a).pageY,r=n-i,s=e.calcAngle(r),c=r>0?t-s:t+s;c>e.endExceed&&(c=e.endExceed),c<e.beginExceed&&(c=e.beginExceed),e.setAngle(c),e.updateInertiaParams(a)},!1),e.list.addEventListener("tap",function(t){elementItem=t.target,"LI"==elementItem.tagName&&e.setSelectedIndex(e.elementItems.indexOf(elementItem),200)},!1)},p.prototype.initInertiaParams=function(){var e=this;e.lastMoveTime=0,e.lastMoveStart=0,e.stopInertiaMove=!1},p.prototype.updateInertiaParams=function(e,t){var i=this,a=e.changedTouches?e.changedTouches[0]:e;if(t)i.lastMoveStart=a.pageY,i.lastMoveTime=e.timeStamp||Date.now(),i.startAngle=i.list.angle;else{var n=e.timeStamp||Date.now();n-i.lastMoveTime>300&&(i.lastMoveTime=n,i.lastMoveStart=a.pageY)}i.stopInertiaMove=!0},p.prototype.startInertiaScroll=function(e){var t=this,i=e.changedTouches?e.changedTouches[0]:e,a=e.timeStamp||Date.now(),n=(i.pageY-t.lastMoveStart)/(a-t.lastMoveTime),r=n>0?-1:1,s=6e-4*r*-1,c=Math.abs(n/s),l=n*c/2,o=t.list.angle,d=t.calcAngle(l)*r,u=d;return o+d<t.beginExceed&&(d=t.beginExceed-o,c=c*(d/u)*.6),o+d>t.endExceed&&(d=t.endExceed-o,c=c*(d/u)*.6),0==d?void t.endScroll():void t.scrollDistAngle(a,o,d,c)},p.prototype.scrollDistAngle=function(e,t,i,a){var n=this;n.stopInertiaMove=!1,function(e,t,i,a){var r=13,s=a/r,c=0;!function l(){if(!n.stopInertiaMove){var e=n.quartEaseOut(c,t,i,s);return n.setAngle(e),c++,c>s-1||e<n.beginExceed||e>n.endExceed?void n.endScroll():void setTimeout(l,r)}}()}(e,t,i,a)},p.prototype.quartEaseOut=function(e,t,i,a){return-i*((e=e/a-1)*e*e*e-1)+t},p.prototype.endScroll=function(){var e=this;if(e.list.angle<e.beginAngle)e.list.style.webkitTransition="150ms ease-out",e.setAngle(e.beginAngle);else if(e.list.angle>e.endAngle)e.list.style.webkitTransition="150ms ease-out",e.setAngle(e.endAngle);else{var t=parseInt((e.list.angle/e.itemAngle).toFixed(0));e.list.style.webkitTransition="100ms ease-out",e.setAngle(e.itemAngle*t)}e.triggerChange()},p.prototype.triggerChange=function(t){var i=this;setTimeout(function(){var a=i.getSelectedIndex(),n=i.items[a];e.trigger&&(a!=i.lastIndex||t)&&e.trigger(i.holder,"change",{index:a,item:n}),i.lastIndex=a},0)},p.prototype.correctAngle=function(e){var t=this;return e<t.beginAngle?t.beginAngle:e>t.endAngle?t.endAngle:e},p.prototype.setItems=function(e){var t=this;t.items=e||[];var i=[];t.items.forEach(function(e){null!==e&&e!==a&&i.push("<li>"+(e.text||e)+"</li>")}),t.list.innerHTML=i.join(""),t.findElementItems(),t.calcElementItemPostion(),t.setAngle(t.correctAngle(t.list.angle)),t.triggerChange(!0)},p.prototype.getItems=function(){var e=this;return e.items},p.prototype.getSelectedIndex=function(){var e=this;return parseInt((e.list.angle/e.itemAngle).toFixed(0))},p.prototype.setSelectedIndex=function(e,t){var i=this;i.list.style.webkitTransition="";var a=i.correctAngle(i.itemAngle*e);if(t&&t>0){var n=a-i.list.angle;i.scrollDistAngle(Date.now(),i.list.angle,n,t)}else i.setAngle(a);i.triggerChange()},p.prototype.getSelectedItem=function(){var e=this;return e.items[e.getSelectedIndex()]},p.prototype.getSelectedValue=function(){var e=this;return(e.items[e.getSelectedIndex()]||{}).value},p.prototype.getSelectedText=function(){var e=this;return(e.items[e.getSelectedIndex()]||{}).text},p.prototype.setSelectedValue=function(e,t){var i=this;for(var a in i.items){var n=i.items[a];if(n.value==e)return void i.setSelectedIndex(a,t)}},e.fn&&(e.fn.picker=function(e){return this.each(function(t,i){if(!i.picker)if(e)i.picker=new p(i,e);else{var a=i.getAttribute("data-picker-options"),n=a?JSON.parse(a):{};i.picker=new p(i,n)}}),this[0]?this[0].picker:null},e.ready(function(){e(".mui-picker").picker()}))}(window.mui||window,window,document,void 0),function(e,t){e.dom=function(i){return"string"!=typeof i?i instanceof Array||i[0]&&i.length?[].slice.call(i):[i]:(e.__create_dom_div__||(e.__create_dom_div__=t.createElement("div")),e.__create_dom_div__.innerHTML=i,[].slice.call(e.__create_dom_div__.childNodes))};var i='<div class="mui-poppicker">		<div class="mui-poppicker-header">			<button class="mui-btn mui-poppicker-btn-cancel">取消</button>			<button class="mui-btn mui-btn-blue mui-poppicker-btn-ok">确定</button>			<div class="mui-poppicker-clear"></div>		</div>		<div class="mui-poppicker-body">		</div>	</div>',a='<div class="mui-picker">		<div class="mui-picker-inner">			<div class="mui-pciker-rule mui-pciker-rule-ft"></div>			<ul class="mui-pciker-list">			</ul>			<div class="mui-pciker-rule mui-pciker-rule-bg"></div>		</div>	</div>';e.PopPicker=e.Class.extend({init:function(a){var n=this;n.options=a||{},n.options.buttons=n.options.buttons||["取消","确定"],n.panel=e.dom(i)[0],t.body.appendChild(n.panel),n.ok=n.panel.querySelector(".mui-poppicker-btn-ok"),n.cancel=n.panel.querySelector(".mui-poppicker-btn-cancel"),n.body=n.panel.querySelector(".mui-poppicker-body"),n.mask=e.createMask(),n.cancel.innerText=n.options.buttons[0],n.ok.innerText=n.options.buttons[1],n.cancel.addEventListener("tap",function(e){n.hide()},!1),n.ok.addEventListener("tap",function(e){if(n.callback){var t=n.callback(n.getSelectedItems());t!==!1&&n.hide()}},!1),n.mask[0].addEventListener("tap",function(){n.hide()},!1),n._createPicker(),n.panel.addEventListener("touchstart",function(e){e.preventDefault()},!1),n.panel.addEventListener("touchmove",function(e){e.preventDefault()},!1)},_createPicker:function(){var t=this,i=t.options.layer||1,n=100/i+"%";t.pickers=[];for(var r=1;i>=r;r++){var s=e.dom(a)[0];s.style.width=n,t.body.appendChild(s);var c=e(s).picker();t.pickers.push(c),s.addEventListener("change",function(e){var t=this.nextSibling;if(t&&t.picker){var i=e.detail||{},a=i.item||{};t.picker.setItems(a.children)}},!1)}},setData:function(e){var t=this;e=e||[],t.pickers[0].setItems(e)},getSelectedItems:function(){var e=this,t=[];for(var i in e.pickers){var a=e.pickers[i];t.push(a.getSelectedItem()||{})}return t},show:function(i){var a=this;a.callback=i,a.mask.show(),t.body.classList.add(e.className("poppicker-active-for-page")),a.panel.classList.add(e.className("active")),a.__back=e.back,e.back=function(){a.hide()}},hide:function(){var i=this;i.disposed||(i.panel.classList.remove(e.className("active")),i.mask.close(),t.body.classList.remove(e.className("poppicker-active-for-page")),e.back=i.__back)},dispose:function(){var e=this;e.hide(),setTimeout(function(){e.panel.parentNode.removeChild(e.panel);for(var t in e)e[t]=null,delete e[t];e.disposed=!0},300)}})}(mui,document),function(e,t){e.dom=function(i){return"string"!=typeof i?i instanceof Array||i[0]&&i.length?[].slice.call(i):[i]:(e.__create_dom_div__||(e.__create_dom_div__=t.createElement("div")),e.__create_dom_div__.innerHTML=i,[].slice.call(e.__create_dom_div__.childNodes))};var i='<div class="mui-dtpicker" data-type="datetime">		<div class="mui-dtpicker-header">			<button data-id="btn-cancel" class="mui-btn">取消</button>			<button data-id="btn-ok" class="mui-btn mui-btn-blue">确定</button>		</div>		<div class="mui-dtpicker-title"><h5 data-id="title-y">年</h5><h5 data-id="title-m">月</h5><h5 data-id="title-d">日</h5><h5 data-id="title-h">时</h5><h5 data-id="title-i">分</h5></div>		<div class="mui-dtpicker-body">			<div data-id="picker-y" class="mui-picker">				<div class="mui-picker-inner">					<div class="mui-pciker-rule mui-pciker-rule-ft"></div>					<ul class="mui-pciker-list">					</ul>					<div class="mui-pciker-rule mui-pciker-rule-bg"></div>				</div>			</div>			<div data-id="picker-m" class="mui-picker">				<div class="mui-picker-inner">					<div class="mui-pciker-rule mui-pciker-rule-ft"></div>					<ul class="mui-pciker-list">					</ul>					<div class="mui-pciker-rule mui-pciker-rule-bg"></div>				</div>			</div>			<div data-id="picker-d" class="mui-picker">				<div class="mui-picker-inner">					<div class="mui-pciker-rule mui-pciker-rule-ft"></div>					<ul class="mui-pciker-list">					</ul>					<div class="mui-pciker-rule mui-pciker-rule-bg"></div>				</div>			</div>			<div data-id="picker-h" class="mui-picker">				<div class="mui-picker-inner">					<div class="mui-pciker-rule mui-pciker-rule-ft"></div>					<ul class="mui-pciker-list">					</ul>					<div class="mui-pciker-rule mui-pciker-rule-bg"></div>				</div>			</div>			<div data-id="picker-i" class="mui-picker">				<div class="mui-picker-inner">					<div class="mui-pciker-rule mui-pciker-rule-ft"></div>					<ul class="mui-pciker-list">					</ul>					<div class="mui-pciker-rule mui-pciker-rule-bg"></div>				</div>			</div>		</div>	</div>';e.DtPicker=e.Class.extend({init:function(a){var n=this,r=e.dom(i)[0];t.body.appendChild(r),e('[data-id*="picker"]',r).picker();var s=n.ui={picker:r,mask:e.createMask(),ok:e('[data-id="btn-ok"]',r)[0],cancel:e('[data-id="btn-cancel"]',r)[0],y:e('[data-id="picker-y"]',r)[0],m:e('[data-id="picker-m"]',r)[0],d:e('[data-id="picker-d"]',r)[0],h:e('[data-id="picker-h"]',r)[0],i:e('[data-id="picker-i"]',r)[0],labels:e('[data-id*="title-"]',r)};s.cancel.addEventListener("tap",function(){n.hide()},!1),s.ok.addEventListener("tap",function(){var e=n.callback(n.getSelected());e!==!1&&n.hide()},!1),s.y.addEventListener("change",function(){n._createDay()},!1),s.m.addEventListener("change",function(){n._createDay()},!1),s.mask[0].addEventListener("tap",function(){n.hide()},!1),n._create(a),n.ui.picker.addEventListener("touchstart",function(e){e.preventDefault()},!1),n.ui.picker.addEventListener("touchmove",function(e){e.preventDefault()},!1)},getSelected:function(){var e=this,t=e.ui,i=e.options.type,a={type:i,y:t.y.picker.getSelectedItem(),m:t.m.picker.getSelectedItem(),d:t.d.picker.getSelectedItem(),h:t.h.picker.getSelectedItem(),i:t.i.picker.getSelectedItem(),toString:function(){return this.value}};switch(i){case"datetime":a.value=a.y.value+"-"+a.m.value+"-"+a.d.value+" "+a.h.value+":"+a.i.value,a.text=a.y.text+"-"+a.m.text+"-"+a.d.text+" "+a.h.text+":"+a.i.text;break;case"date":a.value=a.y.value+"-"+a.m.value+"-"+a.d.value,a.text=a.y.text+"-"+a.m.text+"-"+a.d.text;break;case"time":a.value=a.h.value+":"+a.i.value,a.text=a.h.text+":"+a.i.text;break;case"month":a.value=a.y.value+"-"+a.m.value,a.text=a.y.text+"-"+a.m.text;break;case"hour":a.value=a.y.value+"-"+a.m.value+"-"+a.d.value+" "+a.h.value,a.text=a.y.text+"-"+a.m.text+"-"+a.d.text+" "+a.h.text}return a},setSelectedValue:function(e){var t=this,i=t.ui,a=t._parseValue(e);i.y.picker.setSelectedValue(a.y,0),i.m.picker.setSelectedValue(a.m,0),i.d.picker.setSelectedValue(a.d,0),i.h.picker.setSelectedValue(a.h,0),i.i.picker.setSelectedValue(a.i,0)},isLeapYear:function(e){return e%4==0&&e%100!=0||e%400==0},_inArray:function(e,t){for(var i in e){var a=e[i];if(a===t)return!0}return!1},getDayNum:function(e,t){var i=this;return i._inArray([1,3,5,7,8,10,12],t)?31:i._inArray([4,6,9,11],t)?30:i.isLeapYear(e)?29:28},_fill:function(e){return e=e.toString(),e.length<2&&(e=0+e),e},_createYear:function(e){var t=this,i=t.options,a=t.ui,n=[];if(i.customData.y)n=i.customData.y;else for(var r=i.beginYear,s=i.endYear,c=r;s>=c;c++)n.push({text:c+"",value:c});a.y.picker.setItems(n)},_createMonth:function(e){var t=this,i=t.options,a=t.ui,n=[];if(i.customData.m)n=i.customData.m;else for(var r=1;12>=r;r++){var s=t._fill(r);n.push({text:s,value:s})}a.m.picker.setItems(n)},_createDay:function(e){var t=this,i=t.options,a=t.ui,n=[];if(i.customData.d)n=i.customData.d;else for(var r=t.getDayNum(parseInt(a.y.picker.getSelectedValue()),parseInt(a.m.picker.getSelectedValue())),s=1;r>=s;s++){var c=t._fill(s);n.push({text:c,value:c})}a.d.picker.setItems(n),e=e||a.d.picker.getSelectedValue()},_createHours:function(e){var t=this,i=t.options,a=t.ui,n=[];if(i.customData.h)n=i.customData.h;else for(var r=0;23>=r;r++){var s=t._fill(r);n.push({text:s,value:s})}a.h.picker.setItems(n)},_createMinutes:function(e){var t=this,i=t.options,a=t.ui,n=[];if(i.customData.i)n=i.customData.i;else for(var r=0;59>=r;r++){var s=t._fill(r);n.push({text:s,value:s})}a.i.picker.setItems(n)},_setLabels:function(){var e=this,t=e.options,i=e.ui;i.labels.each(function(e,i){i.innerText=t.labels[e]})},_setButtons:function(){var e=this,t=e.options,i=e.ui;i.cancel.innerText=t.buttons[0],i.ok.innerText=t.buttons[1]},_parseValue:function(e){var t={};if(e){var i=e.replace(":","-").replace(" ","-").split("-");t.y=i[0],t.m=i[1],t.d=i[2],t.h=i[3],t.i=i[4]}else{var a=new Date;t.y=a.getFullYear(),t.m=a.getMonth()+1,t.d=a.getDate(),t.h=a.getHours(),t.i=a.getMinutes()}return t},_create:function(e){var t=this;e=e||{},e.labels=e.labels||["年","月","日","时","分"],e.buttons=e.buttons||["取消","确定"],e.type=e.type||"datetime",e.customData=e.customData||{},t.options=e;var i=new Date;e.beginYear=e.beginYear||i.getFullYear()-5,e.endYear=e.endYear||i.getFullYear()+5;var a=t.ui;t._setLabels(),t._setButtons(),a.picker.setAttribute("data-type",e.type),t._createYear(),t._createMonth(),t._createDay(),t._createHours(),t._createMinutes(),t.setSelectedValue(e.value)},show:function(i){var a=this,n=a.ui;a.callback=i||e.noop,n.mask.show(),t.body.classList.add(e.className("dtpicker-active-for-page")),n.picker.classList.add(e.className("active")),a.__back=e.back,e.back=function(){a.hide()}},hide:function(){var i=this;if(!i.disposed){var a=i.ui;a.picker.classList.remove(e.className("active")),a.mask.close(),t.body.classList.remove(e.className("dtpicker-active-for-page")),e.back=i.__back}},dispose:function(){var e=this;e.hide(),setTimeout(function(){e.ui.picker.parentNode.removeChild(e.ui.picker);for(var t in e)e[t]=null,delete e[t];e.disposed=!0},300)}})}(mui,document);
(function($,window,document,undefined){var MAX_EXCEED=30;var VISIBLE_RANGE=90;var DEFAULT_ITEM_HEIGHT=40;var BLUR_WIDTH=10;var rad2deg=$.rad2deg=function(rad){return rad/(Math.PI/180)};var deg2rad=$.deg2rad=function(deg){return deg*(Math.PI/180)};var platform=navigator.platform.toLowerCase();var userAgent=navigator.userAgent.toLowerCase();var isIos=(userAgent.indexOf('iphone')>-1||userAgent.indexOf('ipad')>-1||userAgent.indexOf('ipod')>-1)&&(platform.indexOf('iphone')>-1||platform.indexOf('ipad')>-1||platform.indexOf('ipod')>-1);var Picker=$.Picker=function(holder,options){var self=this;self.holder=holder;self.options=options||{};self.init();self.initInertiaParams();self.calcElementItemPostion(true);self.bindEvent()};Picker.prototype.findElementItems=function(){var self=this;self.elementItems=[].slice.call(self.holder.querySelectorAll('li'));return self.elementItems};Picker.prototype.init=function(){var self=this;self.list=self.holder.querySelector('ul');self.findElementItems();self.height=self.holder.offsetHeight;self.r=self.height/2-BLUR_WIDTH;self.d=self.r*2;self.itemHeight=self.elementItems.length>0?self.elementItems[0].offsetHeight:DEFAULT_ITEM_HEIGHT;self.itemAngle=parseInt(self.calcAngle(self.itemHeight*0.8));self.hightlightRange=self.itemAngle/2;self.visibleRange=VISIBLE_RANGE;self.beginAngle=0;self.beginExceed=self.beginAngle-MAX_EXCEED;self.list.angle=self.beginAngle;if(isIos){self.list.style.webkitTransformOrigin="center center "+self.r+"px"}};Picker.prototype.calcElementItemPostion=function(andGenerateItms){var self=this;if(andGenerateItms){self.items=[]}self.elementItems.forEach(function(item){var index=self.elementItems.indexOf(item);self.endAngle=self.itemAngle*index;item.angle=self.endAngle;item.style.webkitTransformOrigin="center center -"+self.r+"px";item.style.webkitTransform="translateZ("+self.r+"px) rotateX("+(-self.endAngle)+"deg)";if(andGenerateItms){var dataItem={};dataItem.text=item.innerHTML||'';dataItem.value=item.getAttribute('data-value')||dataItem.text;self.items.push(dataItem)}});self.endExceed=self.endAngle+MAX_EXCEED;self.calcElementItemVisibility(self.beginAngle)};Picker.prototype.calcAngle=function(c){var self=this;var a=b=parseFloat(self.r);c=Math.abs(c);var intDeg=parseInt(c/self.d)*180;c=c%self.d;var cosC=(a*a+b*b-c*c)/(2*a*b);var angleC=intDeg+rad2deg(Math.acos(cosC));return angleC};Picker.prototype.calcElementItemVisibility=function(angle){var self=this;self.elementItems.forEach(function(item){var difference=Math.abs(item.angle-angle);if(difference<self.hightlightRange){item.classList.add('highlight')}else if(difference<self.visibleRange){item.classList.add('visible');item.classList.remove('highlight')}else{item.classList.remove('highlight');item.classList.remove('visible')}})};Picker.prototype.setAngle=function(angle){var self=this;self.list.angle=angle;self.list.style.webkitTransform="perspective(1000px) rotateY(0deg) rotateX("+angle+"deg)";self.calcElementItemVisibility(angle)};Picker.prototype.bindEvent=function(){var self=this;var lastAngle=0;var startY=null;var isPicking=false;self.holder.addEventListener($.EVENT_START,function(event){isPicking=true;event.preventDefault();self.list.style.webkitTransition='';startY=(event.changedTouches?event.changedTouches[0]:event).pageY;lastAngle=self.list.angle;self.updateInertiaParams(event,true)},false);self.holder.addEventListener($.EVENT_END,function(event){isPicking=false;event.preventDefault();self.startInertiaScroll(event)},false);self.holder.addEventListener($.EVENT_CANCEL,function(event){isPicking=false;event.preventDefault();self.startInertiaScroll(event)},false);self.holder.addEventListener($.EVENT_MOVE,function(event){if(!isPicking){return}event.preventDefault();var endY=(event.changedTouches?event.changedTouches[0]:event).pageY;var dragRange=endY-startY;var dragAngle=self.calcAngle(dragRange);var newAngle=dragRange>0?lastAngle-dragAngle:lastAngle+dragAngle;if(newAngle>self.endExceed){newAngle=self.endExceed}if(newAngle<self.beginExceed){newAngle=self.beginExceed}self.setAngle(newAngle);self.updateInertiaParams(event)},false);self.list.addEventListener('tap',function(event){elementItem=event.target;if(elementItem.tagName=='LI'){self.setSelectedIndex(self.elementItems.indexOf(elementItem),200)}},false)};Picker.prototype.initInertiaParams=function(){var self=this;self.lastMoveTime=0;self.lastMoveStart=0;self.stopInertiaMove=false};Picker.prototype.updateInertiaParams=function(event,isStart){var self=this;var point=event.changedTouches?event.changedTouches[0]:event;if(isStart){self.lastMoveStart=point.pageY;self.lastMoveTime=event.timeStamp||Date.now();self.startAngle=self.list.angle}else{var nowTime=event.timeStamp||Date.now();if(nowTime-self.lastMoveTime>300){self.lastMoveTime=nowTime;self.lastMoveStart=point.pageY}}self.stopInertiaMove=true};Picker.prototype.startInertiaScroll=function(event){var self=this;var point=event.changedTouches?event.changedTouches[0]:event;var nowTime=event.timeStamp||Date.now();var v=(point.pageY-self.lastMoveStart)/(nowTime-self.lastMoveTime);var dir=v>0?-1:1;var deceleration=dir*0.0006*-1;var duration=Math.abs(v/deceleration);var dist=v*duration/2;var startAngle=self.list.angle;var distAngle=self.calcAngle(dist)*dir;var srcDistAngle=distAngle;if(startAngle+distAngle<self.beginExceed){distAngle=self.beginExceed-startAngle;duration=duration*(distAngle/srcDistAngle)*0.6}if(startAngle+distAngle>self.endExceed){distAngle=self.endExceed-startAngle;duration=duration*(distAngle/srcDistAngle)*0.6}if(distAngle==0){self.endScroll();return}self.scrollDistAngle(nowTime,startAngle,distAngle,duration)};Picker.prototype.scrollDistAngle=function(nowTime,startAngle,distAngle,duration){var self=this;self.stopInertiaMove=false;(function(nowTime,startAngle,distAngle,duration){var frameInterval=13;var stepCount=duration/frameInterval;var stepIndex=0;(function inertiaMove(){if(self.stopInertiaMove)return;var newAngle=self.quartEaseOut(stepIndex,startAngle,distAngle,stepCount);self.setAngle(newAngle);stepIndex++;if(stepIndex>stepCount-1||newAngle<self.beginExceed||newAngle>self.endExceed){self.endScroll();return}setTimeout(inertiaMove,frameInterval)})()})(nowTime,startAngle,distAngle,duration)};Picker.prototype.quartEaseOut=function(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b};Picker.prototype.endScroll=function(){var self=this;if(self.list.angle<self.beginAngle){self.list.style.webkitTransition="150ms ease-out";self.setAngle(self.beginAngle)}else if(self.list.angle>self.endAngle){self.list.style.webkitTransition="150ms ease-out";self.setAngle(self.endAngle)}else{var index=parseInt((self.list.angle/self.itemAngle).toFixed(0));self.list.style.webkitTransition="100ms ease-out";self.setAngle(self.itemAngle*index)}self.triggerChange()};Picker.prototype.triggerChange=function(force){var self=this;setTimeout(function(){var index=self.getSelectedIndex();var item=self.items[index];if($.trigger&&(index!=self.lastIndex||force===true)){$.trigger(self.holder,'change',{"index":index,"item":item})}self.lastIndex=index;typeof force==='function'&&force()},0)};Picker.prototype.correctAngle=function(angle){var self=this;if(angle<self.beginAngle){return self.beginAngle}else if(angle>self.endAngle){return self.endAngle}else{return angle}};Picker.prototype.setItems=function(items){var self=this;self.items=items||[];var buffer=[];self.items.forEach(function(item){if(item!==null&&item!==undefined){buffer.push('<li>'+(item.text||item)+'</li>')}});self.list.innerHTML=buffer.join('');self.findElementItems();self.calcElementItemPostion();self.setAngle(self.correctAngle(self.list.angle));self.triggerChange(true)};Picker.prototype.getItems=function(){var self=this;return self.items};Picker.prototype.getSelectedIndex=function(){var self=this;return parseInt((self.list.angle/self.itemAngle).toFixed(0))};Picker.prototype.setSelectedIndex=function(index,duration,callback){var self=this;self.list.style.webkitTransition='';var angle=self.correctAngle(self.itemAngle*index);if(duration&&duration>0){var distAngle=angle-self.list.angle;self.scrollDistAngle(Date.now(),self.list.angle,distAngle,duration)}else{self.setAngle(angle)}self.triggerChange(callback)};Picker.prototype.getSelectedItem=function(){var self=this;return self.items[self.getSelectedIndex()]};Picker.prototype.getSelectedValue=function(){var self=this;return(self.items[self.getSelectedIndex()]||{}).value};Picker.prototype.getSelectedText=function(){var self=this;return(self.items[self.getSelectedIndex()]||{}).text};Picker.prototype.setSelectedValue=function(value,duration,callback){var self=this;for(var index in self.items){var item=self.items[index];if(item.value==value){self.setSelectedIndex(index,duration,callback);return}}};if($.fn){$.fn.picker=function(options){this.each(function(i,element){if(element.picker)return;if(options){element.picker=new Picker(element,options)}else{var optionsText=element.getAttribute('data-picker-options');var _options=optionsText?JSON.parse(optionsText):{};element.picker=new Picker(element,_options)}});return this[0]?this[0].picker:null};$.ready(function(){$('.mui-picker').picker()})}})(window.mui||window,window,document,undefined);(function($,document){$.dom=function(str){if(typeof(str)!=='string'){if((str instanceof Array)||(str[0]&&str.length)){return[].slice.call(str)}else{return[str]}}if(!$.__create_dom_div__){$.__create_dom_div__=document.createElement('div')}$.__create_dom_div__.innerHTML=str;return[].slice.call($.__create_dom_div__.childNodes)};var panelBuffer='<div class="mui-poppicker">		<div class="mui-poppicker-header">			<button class="mui-btn mui-poppicker-btn-cancel">取消</button>			<button class="mui-btn mui-btn-blue mui-poppicker-btn-ok">确定</button>			<div class="mui-poppicker-clear"></div>		</div>		<div class="mui-poppicker-body">		</div>	</div>';var pickerBuffer='<div class="mui-picker">		<div class="mui-picker-inner">			<div class="mui-pciker-rule mui-pciker-rule-ft"></div>			<ul class="mui-pciker-list">			</ul>			<div class="mui-pciker-rule mui-pciker-rule-bg"></div>		</div>	</div>';var PopPicker=$.PopPicker=$.Class.extend({init:function(options){var self=this;self.options=options||{};self.options.buttons=self.options.buttons||['取消','确定'];self.panel=$.dom(panelBuffer)[0];document.body.appendChild(self.panel);self.ok=self.panel.querySelector('.mui-poppicker-btn-ok');self.cancel=self.panel.querySelector('.mui-poppicker-btn-cancel');self.body=self.panel.querySelector('.mui-poppicker-body');self.mask=$.createMask();self.cancel.innerText=self.options.buttons[0];self.ok.innerText=self.options.buttons[1];self.cancel.addEventListener('tap',function(event){self.hide()},false);self.ok.addEventListener('tap',function(event){if(self.callback){var rs=self.callback(self.getSelectedItems());if(rs!==false){self.hide()}}},false);self.mask[0].addEventListener('tap',function(){self.hide()},false);self._createPicker();self.panel.addEventListener($.EVENT_START,function(event){event.preventDefault()},false);self.panel.addEventListener($.EVENT_MOVE,function(event){event.preventDefault()},false)},_createPicker:function(){var self=this;var layer=self.options.layer||1;var width=(100/layer)+'%';self.pickers=[];for(var i=1;i<=layer;i++){var pickerElement=$.dom(pickerBuffer)[0];pickerElement.style.width=width;self.body.appendChild(pickerElement);var picker=$(pickerElement).picker();self.pickers.push(picker);pickerElement.addEventListener('change',function(event){var nextPickerElement=this.nextSibling;if(nextPickerElement&&nextPickerElement.picker){var eventData=event.detail||{};var preItem=eventData.item||{};nextPickerElement.picker.setItems(preItem.children)}},false)}},setData:function(data){var self=this;data=data||[];self.pickers[0].setItems(data)},getSelectedItems:function(){var self=this;var items=[];for(var i in self.pickers){var picker=self.pickers[i];items.push(picker.getSelectedItem()||{})}return items},show:function(callback){var self=this;self.callback=callback;self.mask.show();document.body.classList.add($.className('poppicker-active-for-page'));self.panel.classList.add($.className('active'));self.__back=$.back;$.back=function(){self.hide()}},hide:function(){var self=this;if(self.disposed)return;self.panel.classList.remove($.className('active'));self.mask.close();document.body.classList.remove($.className('poppicker-active-for-page'));$.back=self.__back},dispose:function(){var self=this;self.hide();setTimeout(function(){self.panel.parentNode.removeChild(self.panel);for(var name in self){self[name]=null;delete self[name]};self.disposed=true},300)}})})(mui,document);(function($,document){$.dom=function(str){if(typeof(str)!=='string'){if((str instanceof Array)||(str[0]&&str.length)){return[].slice.call(str)}else{return[str]}}if(!$.__create_dom_div__){$.__create_dom_div__=document.createElement('div')}$.__create_dom_div__.innerHTML=str;return[].slice.call($.__create_dom_div__.childNodes)};var domBuffer='<div class="mui-dtpicker" data-type="datetime">		<div class="mui-dtpicker-header">			<button data-id="btn-cancel" class="mui-btn">取消</button>			<button data-id="btn-ok" class="mui-btn mui-btn-blue">确定</button>		</div>		<div class="mui-dtpicker-title"><h5 data-id="title-y">年</h5><h5 data-id="title-m">月</h5><h5 data-id="title-d">日</h5><h5 data-id="title-h">时</h5><h5 data-id="title-i">分</h5></div>		<div class="mui-dtpicker-body">			<div data-id="picker-y" class="mui-picker">				<div class="mui-picker-inner">					<div class="mui-pciker-rule mui-pciker-rule-ft"></div>					<ul class="mui-pciker-list">					</ul>					<div class="mui-pciker-rule mui-pciker-rule-bg"></div>				</div>			</div>			<div data-id="picker-m" class="mui-picker">				<div class="mui-picker-inner">					<div class="mui-pciker-rule mui-pciker-rule-ft"></div>					<ul class="mui-pciker-list">					</ul>					<div class="mui-pciker-rule mui-pciker-rule-bg"></div>				</div>			</div>			<div data-id="picker-d" class="mui-picker">				<div class="mui-picker-inner">					<div class="mui-pciker-rule mui-pciker-rule-ft"></div>					<ul class="mui-pciker-list">					</ul>					<div class="mui-pciker-rule mui-pciker-rule-bg"></div>				</div>			</div>			<div data-id="picker-h" class="mui-picker">				<div class="mui-picker-inner">					<div class="mui-pciker-rule mui-pciker-rule-ft"></div>					<ul class="mui-pciker-list">					</ul>					<div class="mui-pciker-rule mui-pciker-rule-bg"></div>				</div>			</div>			<div data-id="picker-i" class="mui-picker">				<div class="mui-picker-inner">					<div class="mui-pciker-rule mui-pciker-rule-ft"></div>					<ul class="mui-pciker-list">					</ul>					<div class="mui-pciker-rule mui-pciker-rule-bg"></div>				</div>			</div>		</div>	</div>';var DtPicker=$.DtPicker=$.Class.extend({init:function(options){var self=this;var _picker=$.dom(domBuffer)[0];document.body.appendChild(_picker);$('[data-id*="picker"]',_picker).picker();var ui=self.ui={picker:_picker,mask:$.createMask(),ok:$('[data-id="btn-ok"]',_picker)[0],cancel:$('[data-id="btn-cancel"]',_picker)[0],y:$('[data-id="picker-y"]',_picker)[0],m:$('[data-id="picker-m"]',_picker)[0],d:$('[data-id="picker-d"]',_picker)[0],h:$('[data-id="picker-h"]',_picker)[0],i:$('[data-id="picker-i"]',_picker)[0],labels:$('[data-id*="title-"]',_picker),};ui.cancel.addEventListener('tap',function(){self.hide()},false);ui.ok.addEventListener('tap',function(){var rs=self.callback(self.getSelected());if(rs!==false){self.hide()}},false);ui.y.addEventListener('change',function(e){if(self.options.beginMonth||self.options.endMonth){self._createMonth()}else{self._createDay()}},false);ui.m.addEventListener('change',function(e){self._createDay()},false);ui.d.addEventListener('change',function(e){if(self.options.beginMonth||self.options.endMonth){self._createHours()}},false);ui.h.addEventListener('change',function(e){if(self.options.beginMonth||self.options.endMonth){self._createMinutes()}},false);ui.mask[0].addEventListener('tap',function(){self.hide()},false);self._create(options);self.ui.picker.addEventListener($.EVENT_START,function(event){event.preventDefault()},false);self.ui.picker.addEventListener($.EVENT_MOVE,function(event){event.preventDefault()},false)},getSelected:function(){var self=this;var ui=self.ui;var type=self.options.type;var selected={type:type,y:ui.y.picker.getSelectedItem(),m:ui.m.picker.getSelectedItem(),d:ui.d.picker.getSelectedItem(),h:ui.h.picker.getSelectedItem(),i:ui.i.picker.getSelectedItem(),toString:function(){return this.value}};switch(type){case'datetime':selected.value=selected.y.value+'-'+selected.m.value+'-'+selected.d.value+' '+selected.h.value+':'+selected.i.value;selected.text=selected.y.text+'-'+selected.m.text+'-'+selected.d.text+' '+selected.h.text+':'+selected.i.text;break;case'date':selected.value=selected.y.value+'-'+selected.m.value+'-'+selected.d.value;selected.text=selected.y.text+'-'+selected.m.text+'-'+selected.d.text;break;case'time':selected.value=selected.h.value+':'+selected.i.value;selected.text=selected.h.text+':'+selected.i.text;break;case'year':selected.value=selected.y.value;selected.text=selected.y.text;break;case'month':selected.value=selected.y.value+'-'+selected.m.value;selected.text=selected.y.text+'-'+selected.m.text;break;case'hour':selected.value=selected.y.value+'-'+selected.m.value+'-'+selected.d.value+' '+selected.h.value;selected.text=selected.y.text+'-'+selected.m.text+'-'+selected.d.text+' '+selected.h.text;break}return selected},setSelectedValue:function(value){var self=this;var ui=self.ui;var parsedValue=self._parseValue(value);ui.y.picker.setSelectedValue(parsedValue.y,0,function(){ui.m.picker.setSelectedValue(parsedValue.m,0,function(){ui.d.picker.setSelectedValue(parsedValue.d,0,function(){ui.h.picker.setSelectedValue(parsedValue.h,0,function(){ui.i.picker.setSelectedValue(parsedValue.i,0)})})})})},isLeapYear:function(year){return(year%4==0&&year%100!=0)||(year%400==0)},_inArray:function(array,item){for(var index in array){var _item=array[index];if(_item===item)return true}return false},getDayNum:function(year,month){var self=this;if(self._inArray([1,3,5,7,8,10,12],month)){return 31}else if(self._inArray([4,6,9,11],month)){return 30}else if(self.isLeapYear(year)){return 29}else{return 28}},_fill:function(num){num=num.toString();if(num.length<2){num=0+num}return num},_isBeginYear:function(){return this.options.beginYear===parseInt(this.ui.y.picker.getSelectedValue())},_isBeginMonth:function(){return this.options.beginMonth&&this._isBeginYear()&&this.options.beginMonth===parseInt(this.ui.m.picker.getSelectedValue())},_isBeginDay:function(){return this._isBeginMonth()&&this.options.beginDay===parseInt(this.ui.d.picker.getSelectedValue())},_isBeginHours:function(){return this._isBeginDay()&&this.options.beginHours===parseInt(this.ui.h.picker.getSelectedValue())},_isEndYear:function(){return this.options.endYear===parseInt(this.ui.y.picker.getSelectedValue())},_isEndMonth:function(){return this.options.endMonth&&this._isEndYear()&&this.options.endMonth===parseInt(this.ui.m.picker.getSelectedValue())},_isEndDay:function(){return this._isEndMonth()&&this.options.endDay===parseInt(this.ui.d.picker.getSelectedValue())},_isEndHours:function(){return this._isEndDay()&&this.options.endHours===parseInt(this.ui.h.picker.getSelectedValue())},_createYear:function(current){var self=this;var options=self.options;var ui=self.ui;var yArray=[];if(options.customData.y){yArray=options.customData.y}else{var yBegin=options.beginYear;var yEnd=options.endYear;for(var y=yBegin;y<=yEnd;y++){yArray.push({text:y+'',value:y})}}ui.y.picker.setItems(yArray)},_createMonth:function(current){var self=this;var options=self.options;var ui=self.ui;var mArray=[];if(options.customData.m){mArray=options.customData.m}else{var m=options.beginMonth&&self._isBeginYear()?options.beginMonth:1;var maxMonth=options.endMonth&&self._isEndYear()?options.endMonth:12;for(;m<=maxMonth;m++){var val=self._fill(m);mArray.push({text:val,value:val})}}ui.m.picker.setItems(mArray)},_createDay:function(current){var self=this;var options=self.options;var ui=self.ui;var dArray=[];if(options.customData.d){dArray=options.customData.d}else{var d=self._isBeginMonth()?options.beginDay:1;var maxDay=self._isEndMonth()?options.endDay:self.getDayNum(parseInt(this.ui.y.picker.getSelectedValue()),parseInt(this.ui.m.picker.getSelectedValue()));for(;d<=maxDay;d++){var val=self._fill(d);dArray.push({text:val,value:val})}}ui.d.picker.setItems(dArray);current=current||ui.d.picker.getSelectedValue()},_createHours:function(current){var self=this;var options=self.options;var ui=self.ui;var hArray=[];if(options.customData.h){hArray=options.customData.h}else{var h=self._isBeginDay()?options.beginHours:0;var maxHours=self._isEndDay()?options.endHours:23;for(;h<=maxHours;h++){var val=self._fill(h);hArray.push({text:val,value:val})}}ui.h.picker.setItems(hArray)},_createMinutes:function(current){var self=this;var options=self.options;var ui=self.ui;var iArray=[];if(options.customData.i){iArray=options.customData.i}else{var i=self._isBeginHours()?options.beginMinutes:0;var maxMinutes=self._isEndHours()?options.endMinutes:59;for(;i<=maxMinutes;i++){var val=self._fill(i);iArray.push({text:val,value:val})}}ui.i.picker.setItems(iArray)},_setLabels:function(){var self=this;var options=self.options;var ui=self.ui;ui.labels.each(function(i,label){label.innerText=options.labels[i]})},_setButtons:function(){var self=this;var options=self.options;var ui=self.ui;ui.cancel.innerText=options.buttons[0];ui.ok.innerText=options.buttons[1]},_parseValue:function(value){var self=this;var rs={};if(value){var parts=value.replace(":","-").replace(" ","-").split("-");rs.y=parts[0];rs.m=parts[1];rs.d=parts[2];rs.h=parts[3];rs.i=parts[4]}else{var now=new Date();rs.y=now.getFullYear();rs.m=now.getMonth()+1;rs.d=now.getDate();rs.h=now.getHours();rs.i=now.getMinutes()}return rs},_create:function(options){var self=this;options=options||{};options.labels=options.labels||['年','月','日','时','分'];options.buttons=options.buttons||['取消','确定'];options.type=options.type||'datetime';options.customData=options.customData||{};self.options=options;var now=new Date();var beginDate=options.beginDate;if(beginDate instanceof Date&&!isNaN(beginDate.valueOf())){options.beginYear=beginDate.getFullYear();options.beginMonth=beginDate.getMonth()+1;options.beginDay=beginDate.getDate();options.beginHours=beginDate.getHours();options.beginMinutes=beginDate.getMinutes()}var endDate=options.endDate;if(endDate instanceof Date&&!isNaN(endDate.valueOf())){options.endYear=endDate.getFullYear();options.endMonth=endDate.getMonth()+1;options.endDay=endDate.getDate();options.endHours=endDate.getHours();options.endMinutes=endDate.getMinutes()}options.beginYear=options.beginYear||(now.getFullYear()-5);options.endYear=options.endYear||(now.getFullYear()+5);var ui=self.ui;self._setLabels();self._setButtons();ui.picker.setAttribute('data-type',options.type);self._createYear();self._createMonth();self._createDay();self._createHours();self._createMinutes();self.setSelectedValue(options.value)},show:function(callback){var self=this;var ui=self.ui;self.callback=callback||$.noop;ui.mask.show();document.body.classList.add($.className('dtpicker-active-for-page'));ui.picker.classList.add($.className('active'));self.__back=$.back;$.back=function(){self.hide()}},hide:function(){var self=this;if(self.disposed)return;var ui=self.ui;ui.picker.classList.remove($.className('active'));ui.mask.close();document.body.classList.remove($.className('dtpicker-active-for-page'));$.back=self.__back},dispose:function(){var self=this;self.hide();setTimeout(function(){self.ui.picker.parentNode.removeChild(self.ui.picker);for(var name in self){self[name]=null;delete self[name]};self.disposed=true},300)}})})(mui,document);