<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/mui.picker.min.css" />
		<link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />
		<link href="css/mui.poppicker.css" rel="stylesheet" />
		<style>

		</style>
	</head>

	<body>
		<script src="js/mui.min.js"></script>
		<button type="button" class="mui-btn mui-btn-primary" onclick="print()" id="buttonok">打印</button>&nbsp;&nbsp;
		<script>
		   var device,uuid ;
			mui.init({});
			mui.plusReady(function() {
				var main, Context, BluetoothManager, BluetoothAdapter, BManager, BAdapter;
				//打开蓝牙
				main = plus.android.runtimeMainActivity();
				/*这是成功的*/
				BluetoothAdapter = plus.android.importClass("android.bluetooth.BluetoothAdapter");
				BAdapter = BluetoothAdapter.getDefaultAdapter();
				if (!BAdapter.isEnabled()) {
					BAdapter.enable();
				}

		
				var UUID = plus.android.importClass("java.util.UUID");
				uuid = UUID.fromString("00001101-0000-1000-8000-00805F9B34FB");
//				uuid = UUID.fromString("00000000-0000-1000-8000-00805F9B34FB");
				BAdapter.cancelDiscovery(); //停止扫描
				var addres_mac = plus.storage.getItem("BTP-P33");
				console.log(addres_mac);
				//传入打印机mac地址
//				var addres_mac = "8C:DE:52:EE:DB:B7";
				//plus.storage.getItem("printer");
				device = BAdapter.getRemoteDevice(addres_mac);
				plus.android.importClass(device);
			});

			function print() {
				var bluetoothSocket = device.createInsecureRfcommSocketToServiceRecord(uuid);
				plus.android.importClass(bluetoothSocket);
				if (!bluetoothSocket.isConnected()) {
					bluetoothSocket.connect();
				}
				var outputStream = bluetoothSocket.getOutputStream();
				plus.android.importClass(outputStream);
				var string = "你好123";
				var bytes = plus.android.invoke(string, 'getBytes', 'gbk');
				console.log(bytes+"."+bytes.length); 
				outputStream.write(bytes);
				outputStream.flush();
			}
		</script>
	</body>

</html>