<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<!--标准mui.css-->
		<link rel="stylesheet" href="css/mui.min.css">
		<!--App自定义的css-->
		<link rel="stylesheet" type="text/css" href="css/app.css" />
		<style>
			.title {
				margin: 20px 15px 10px;
				color: #6d6d72;
				font-size: 15px;
			}
		</style>
	</head>

	<body>
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<ul class="mui-table-view mui-table-view-chevron">
				<!--<li class="mui-table-view-cell mui-media">
					<img class="mui-media-object mui-pull-left" src="img/autoresponders.png">
					<span style="font-family: '微软雅黑'; font-size:large;display: inline-block; padding: 10px 6px;">消息通知</span>
					<span class="mui-badge mui-badge-primary">14</span>
				</li>-->
				<li class="mui-table-view-cell mui-media" onclick="OpenWorkFlow()">
					<img class="mui-media-object mui-pull-left" src="img/desktop_network.png">
					<span style="font-family: '微软雅黑'; font-size:large;display: inline-block; padding: 10px 6px;">流程审批</span>
					<span class="mui-badge mui-badge-primary" id="WokrFlowCount">0</span>
				</li>
				<li class="mui-table-view-cell mui-media" onclick="OpenWorkTask()">
					<img class="mui-media-object mui-pull-left" src="img/client_account_template.png">
					<span style="font-family: '微软雅黑'; font-size:large;display: inline-block; padding: 10px 6px;">工作任务</span>
					<span class="mui-badge mui-badge-primary" id="WokrTaskCount">0</span>
				</li>
			</ul>
		</div>

	</body>
	<script src="js/mui.min.js"></script>
	<script src="js/app.js"></script>
	<script>
		mui.init({
			pullRefresh: {
				container: '#pullrefresh',
				down: {
					callback: pulldownRefresh
				},
			}
		});

		function pulldownRefresh() {
			Init();
			mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
		}
		mui.plusReady(function() {
			Init();
		});

		function Init() {
			var logininfo = app.getLoginInfo();
			var info = {
				UserID: logininfo.userid,
			};
			var WokrFlowCount = document.getElementById("WokrFlowCount")
			var WokrTaskCount = document.getElementById("WokrTaskCount")
			var url = app.getUrl() + 'GetWorkFlowCount';
			mui.ajax(url, {
				data: info,
				dataType: 'json',
				type: 'post',
				success: function(data) {
					if (data) {
						WokrFlowCount.innerHTML = data[0].workflownumber;
						WokrTaskCount.innerHTML = data[0].worktasknumber;
					}
				}
			});
		}
        //打开流程画面
		function OpenWorkFlow() {
			var nwaiting = plus.nativeUI.showWaiting();
			var workflowPage = plus.webview.create(
				'workflow-main.html',
				'workflow-main'
			); //后台创建webview并打开show.html
			workflowPage.addEventListener("loaded", function() { //注册新webview的载入完成事件
				setTimeout(function() {
					nwaiting.close();
					//新webview的载入完毕后关闭等待框
					workflowPage.show("pop-in"); //把新webview窗体显示出来，显示动画效果为速度150毫秒的右侧移入动画
				}, 300);
			}, false);
		}
		//打开工作任务画面
		function OpenWorkTask() {
			var nwaiting = plus.nativeUI.showWaiting();
			var workflowPage = plus.webview.create(
				'worktask-main.html',
				'worktask-main'
			); //后台创建webview并打开show.html
			workflowPage.addEventListener("loaded", function() { //注册新webview的载入完成事件
				setTimeout(function() {
					nwaiting.close();
					//新webview的载入完毕后关闭等待框
					workflowPage.show("pop-in"); //把新webview窗体显示出来，显示动画效果为速度150毫秒的右侧移入动画
				}, 300);
			}, false);
		}
	</script>

</html>